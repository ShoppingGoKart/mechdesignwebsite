<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vehicle 1">
<meta name="description" content="The calculations and evaluations of our vehicle that justify and verify our design choices.">

<title>Evaluation of Design – Ferrari GK</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Ferrari GK</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./designfeatures.html"> 
<span class="menu-text">Subsystems Design Features</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./evaluationofdesign.html" aria-current="page"> 
<span class="menu-text">Evaluation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./references.html"> 
<span class="menu-text">References</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overall-system-calculations" id="toc-overall-system-calculations" class="nav-link active" data-scroll-target="#overall-system-calculations">Overall System Calculations</a>
  <ul class="collapse">
  <li><a href="#torsional-stress" id="toc-torsional-stress" class="nav-link" data-scroll-target="#torsional-stress">Torsional Stress</a></li>
  <li><a href="#bending-stress-and-deflection-of-back-axle" id="toc-bending-stress-and-deflection-of-back-axle" class="nav-link" data-scroll-target="#bending-stress-and-deflection-of-back-axle">Bending Stress and Deflection of Back Axle</a></li>
  </ul></li>
  <li><a href="#bearings-lifetime-evaluation" id="toc-bearings-lifetime-evaluation" class="nav-link" data-scroll-target="#bearings-lifetime-evaluation">Bearings Lifetime Evaluation</a></li>
  <li><a href="#chain-calculations" id="toc-chain-calculations" class="nav-link" data-scroll-target="#chain-calculations">Chain Calculations</a></li>
  <li><a href="#load-analysis-on-cart-and-frame-attachment" id="toc-load-analysis-on-cart-and-frame-attachment" class="nav-link" data-scroll-target="#load-analysis-on-cart-and-frame-attachment">Load Analysis on Cart and Frame Attachment</a></li>
  <li><a href="#ziptie-analysis" id="toc-ziptie-analysis" class="nav-link" data-scroll-target="#ziptie-analysis">Ziptie Analysis</a></li>
  <li><a href="#bending-stress-of-80-20" id="toc-bending-stress-of-80-20" class="nav-link" data-scroll-target="#bending-stress-of-80-20">Bending Stress of 80-20</a></li>
  <li><a href="#hose-clamp-analysis" id="toc-hose-clamp-analysis" class="nav-link" data-scroll-target="#hose-clamp-analysis">Hose Clamp Analysis</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Evaluation of Design</h1>
</div>

<div>
  <div class="description">
    The calculations and evaluations of our vehicle that justify and verify our design choices.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vehicle 1 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<!-- Evaluation of Design (may include hand calculations, FEA, motion studies, literature review, and testing results)
Thoroughly evaluates and justifies design decisions using hand calculations, computational tools (motion studies and FEA), or literature review -->
<section id="overall-system-calculations" class="level2">
<h2 class="anchored" data-anchor-id="overall-system-calculations">Overall System Calculations</h2>
<p>The calculations below show how we solved for the desired torque and speed of the system, assuming that our entire system weighs 300 pounds and we want a speed of at least 5mph and acceleration of 1 m/s^2.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/overallsystem1.png" class="img-fluid figure-img"></p>
<figcaption>Desired torque and angular velocity calculations</figcaption>
</figure>
</div>
<p>Because our desired torque output is much greater than what the motor actually outputs, we needed to determine the necessary gear ratio in order to increase the torque of the motor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/overallsystem2.png" class="img-fluid figure-img"></p>
<figcaption>Gear ratio calculations</figcaption>
</figure>
</div>
<p>By using the motor RPM and torque chart, we were able to determine that we would need a 6.31 gear ratio in order to reach the desired torque. Thus, we implemented two sprockets for our back axle, where the driving axle has a 10 tooth sprocket transmitting power to a 65 tooth sprocket connected to the wheels.</p>
<p>We could also determine the expected power output to be 0.43 hp by using the angular velocity and torque.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/overallsystem3.png" class="img-fluid figure-img"></p>
<figcaption>Power of System calculations</figcaption>
</figure>
</div>
<section id="torsional-stress" class="level3">
<h3 class="anchored" data-anchor-id="torsional-stress">Torsional Stress</h3>
<p>We can first draw a FBD of the torsional stresses acting on the shaft due to the tension of the chain acting on the sprocket. From our calculations above, we know that the torque is expected to be 13.25 lb-ft due to the gear ratio implemented. Thus, we need to find the 2 forces acting on the sprocket due to the chain.</p>
<p>F1 is tension, while F2 is in slack due to how the chains are moving relative to each other. Thus, we can assume F2 = 0, and solve for F1 using the known torque value.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/backaxle1.png" class="img-fluid figure-img"></p>
<figcaption>Back Shaft Force Calculations</figcaption>
</figure>
</div>
<p>We can now also find the shear stress acting on the back shaft and compare it to teh tensile strength of the steel we are using.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/backaxle2.png" class="img-fluid figure-img"></p>
<figcaption>Shear Stress on Back Shaft Calculations</figcaption>
</figure>
</div>
<p>Carbon steel has a tensile strength between 400-700 MPa, and the stress expected to act on our shaft is significantly less than that. Thus, our back shaft should be able to withstand the shear and torsional stress it undergoes.</p>
</section>
<section id="bending-stress-and-deflection-of-back-axle" class="level3">
<h3 class="anchored" data-anchor-id="bending-stress-and-deflection-of-back-axle">Bending Stress and Deflection of Back Axle</h3>
<p>We then wanted to determine the deflection and bending stress that the back axle experiences. We could simplify the system as a simply supported beam with 2 point loads (where the bearings attach to the frame of the vehicle). Since our entire vehicle is 300 pounds, we assumed that the back of the vehicle will hold roughly half of that weight (~150 pounds). Thus, each point load will hold about 75 pounds assuming an equal distribution across the shaft.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/backaxlebending1.png" class="img-fluid figure-img"></p>
<figcaption>Maximum Deflection of Back Shaft Calculations</figcaption>
</figure>
</div>
<p>The maximum deflection calculated located in the center of the shaft is 0.4 inches, which is greater than what we expected and saw in our system as it was performing.</p>
<p>We could find the maximum bending stress by finding the maximum moment.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/backaxlebending2.png" class="img-fluid figure-img"></p>
<figcaption>Maximum Bending Stress of Back Shaft Calculations</figcaption>
</figure>
</div>
<p>The bending stress of 172.37 MPa was less than the yield stress of structural steel, and thus will not yield under the expected load.</p>
</section>
</section>
<section id="bearings-lifetime-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="bearings-lifetime-evaluation">Bearings Lifetime Evaluation</h2>
<p>In order to find the lifetime of the back axle bearings, we can model the bearings as a simply supported theme with 2 point loads acting on the bearings from the weight of the vehicle similar to how we modeled the system to solve for bending stress.</p>
<p>This allows us to find the force of the bearings and the power outputted by the shaft.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bearings1.png" class="img-fluid figure-img"></p>
<figcaption>Back Shaft Bearings Force and Power Calculations</figcaption>
</figure>
</div>
<p>The power that the shaft outputs is 0.44 hp, which is within the capacity of our physical motor and seems reasonable to our expectations of its performance.</p>
<p>We can now find the lifetime of the bearings by using the values calculated above along with additional values found from the Block Bearing’s specification sheet.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bearings2.png" class="img-fluid figure-img"></p>
<figcaption>Back Shaft Bearings Lifetime Calculations</figcaption>
</figure>
</div>
<p>The lifetime of the bearings is 6.36 * 10^13, which is a very long lifetime for our vehicle. Thus, the bearings chosen are approrpriate for it use.</p>
</section>
<section id="chain-calculations" class="level2">
<h2 class="anchored" data-anchor-id="chain-calculations">Chain Calculations</h2>
<p>Our system uses a #35 chain to connect the sprocket, so we first had to determine the allowable horsepower of the chain and potential areas of failure. Thus, we first found the nominal power for a #35 single stranded chain.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/chaincalc1.png" class="img-fluid figure-img"></p>
<figcaption>Nominal power of link plated and roller limited chain calculations</figcaption>
</figure>
</div>
<p>After our calculations, we determined that the link plated will break before the roller limited, so we will use the link plated value to determine the allowable horsepower.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/chaincalc2.png" class="img-fluid figure-img"></p>
<figcaption>Allowable Horsepower Calculations</figcaption>
</figure>
</div>
</section>
<section id="load-analysis-on-cart-and-frame-attachment" class="level2">
<h2 class="anchored" data-anchor-id="load-analysis-on-cart-and-frame-attachment">Load Analysis on Cart and Frame Attachment</h2>
<p><img src="images/cartframeload1.png" class="img-fluid" alt="Load Analysis on Cart and Frame Attachment"> <img src="images/cartframeload2.png" class="img-fluid" alt="Bolt Stress Calculations"> <img src="images/cartframeload3.png" class="img-fluid" alt="Bolt Stress Calculations"> <img src="images/cartframeload4.png" class="img-fluid" alt="ZipTie Frame Calculations"></p>
</section>
<section id="ziptie-analysis" class="level2">
<h2 class="anchored" data-anchor-id="ziptie-analysis">Ziptie Analysis</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ziptiecalc.png" class="img-fluid figure-img"></p>
<figcaption>ZipTie Calculations</figcaption>
</figure>
</div>
</section>
<section id="bending-stress-of-80-20" class="level2">
<h2 class="anchored" data-anchor-id="bending-stress-of-80-20">Bending Stress of 80-20</h2>
<p><img src="images/framebendingstress.png" class="img-fluid" alt="Bending Stress of Frame Calculations"> <img src="images/hoseclamp.png" class="img-fluid" alt="80-20 Stress Calculations"></p>
</section>
<section id="hose-clamp-analysis" class="level2">
<h2 class="anchored" data-anchor-id="hose-clamp-analysis">Hose Clamp Analysis</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hoseclampcalc.png" class="img-fluid figure-img"></p>
<figcaption>Hose Clamp Stress Calculations</figcaption>
</figure>
</div>
<p>PICTURES: ASSUMPTIONS NUMBERS/CONCLUSIONS DISCUSSION ON RESULTS</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mechdesignwebsite\.github\.io\/mechdesignwebsite\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>